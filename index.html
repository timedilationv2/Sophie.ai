<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sophie.AI - AI Model Navigator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for Inter font and general body */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fdfcfb;
            color: #1f2937;
            /* Ensure smooth scrolling for sticky elements */
            scroll-behavior: smooth;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
            max-height: 50vh;
        }
        /* Custom scrollbar for better aesthetics */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        /* Sticky filter section for persistent navigation */
        .filter-section {
            position: sticky;
            top: 1.5rem; /* Adjust as needed based on header height */
            height: calc(100vh - 3rem); /* Full viewport height minus top/bottom padding */
            overflow-y: auto; /* Enable scrolling for filter content */
        }
        /* Modal z-index to ensure it overlays all content */
        #modelModal, #comparisonModal {
            z-index: 1000;
        }

        /* Spinner for loading state */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6; /* Tailwind blue-500 */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">
    <div id="app" class="min-h-screen">
        <!-- Header Section -->
        <header class="bg-white/80 backdrop-blur-lg border-b border-gray-200 sticky top-0 z-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl font-bold text-gray-800">Sophie.AI</h1>
                    <p class="text-sm text-gray-500 hidden sm:block">Navigate the AI Ecosystem</p>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 lg:grid-cols-4 lg:gap-8">
                <!-- Sidebar Filter Section -->
                <aside class="lg:col-span-1 mb-8 lg:mb-0">
                    <div class="filter-section">
                        <div class="p-6 bg-white rounded-xl border border-gray-200 shadow-sm h-full overflow-y-auto">
                            <h2 class="text-lg font-semibold mb-4 text-gray-800">Explore Models</h2>
                            <div class="space-y-6">
                                <!-- Search Input -->
                                <div>
                                    <label for="search" class="block text-sm font-medium text-gray-700 mb-1">Search by Name</label>
                                    <input type="text" id="search" placeholder="e.g., GPT-4o" class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                </div>
                                <!-- Provider Filter Dropdown -->
                                <div>
                                    <label for="provider-filter" class="block text-sm font-medium text-gray-700 mb-1">Provider</label>
                                    <select id="provider-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition">
                                        <option value="">All Providers</option>
                                        <!-- Options populated by JS -->
                                    </select>
                                </div>
                                <!-- Use Case Checkboxes -->
                                <div>
                                    <h3 class="text-sm font-medium text-gray-700 mb-2">Use Case</h3>
                                    <div id="use-case-filters" class="space-y-2">
                                        <!-- Checkboxes populated by JS -->
                                    </div>
                                </div>
                                <!-- Reset Filters Button -->
                                <div>
                                    <button id="reset-filters" class="w-full text-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition">Reset Filters</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </aside>

                <!-- Main Content Area (Welcome, Chart, Model Grid) -->
                <div class="lg:col-span-3">
                    <!-- Welcome Section -->
                    <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6 mb-8">
                        <h2 class="text-2xl font-bold tracking-tight text-gray-900 mb-2">Welcome to the AI Model Navigator</h2>
                        <p class="text-gray-600">
                           This interactive prototype for Sophie.AI helps you explore the rapidly expanding landscape of AI. Use the filters on the left to discover, compare, and learn about various Large Language Models (LLMs). The goal is to simplify your search for the right AI tool by providing a centralized, easy-to-navigate index of their capabilities, costs, and more.
                        </p>
                    </div>
                    <!-- Context Window Chart Section -->
                    <div class="bg-white rounded-xl border border-gray-200 shadow-sm p-6 mb-8">
                         <h3 class="text-xl font-semibold text-gray-900 mb-4">Context Window Comparison (Tokens)</h3>
                         <p class="text-sm text-gray-500 mb-4">This chart visualizes the maximum context window of the currently filtered models. A larger context window allows the model to process and remember more information from a single prompt. This chart updates as you apply filters.</p>
                        <div class="chart-container">
                            <canvas id="contextChart"></canvas>
                        </div>
                    </div>
                    <!-- Model Grid -->
                    <div id="models-grid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                        <!-- Model cards will be rendered here by JavaScript -->
                    </div>
                    <!-- No Results Message -->
                    <p id="no-results" class="text-center text-gray-500 py-12 hidden">No models match your criteria.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Model Detail Modal -->
    <div id="modelModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl max-w-lg w-full p-6 relative m-4">
            <button id="modalClose" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl font-bold">✕</button>
            <h2 id="modalTitle" class="text-3xl font-bold mb-2 text-gray-900"></h2>
            <p id="modalProvider" class="text-base text-gray-600 mb-4"></p>

            <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                <h3 class="font-semibold text-lg mb-2 text-gray-800">Benchmarks:</h3>
                <div id="modalBenchmarks" class="text-sm text-gray-700 space-y-1"></div>
            </div>

            <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                <h3 class="font-semibold text-lg mb-2 text-gray-800">Links:</h3>
                <div id="modalLinks" class="text-sm text-gray-700 space-y-1"></div>
            </div>

            <div class="text-sm text-gray-500 mt-6 pt-4 border-t border-gray-200">
                <strong>API Endpoint:</strong> <span id="modalEndpoint"></span>
            </div>
        </div>
    </div>

    <!-- Floating Compare Button -->
    <div id="compareButtonContainer" class="fixed bottom-6 right-6 z-30 hidden">
        <button id="compareModelsBtn" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:bg-blue-700 transition transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300 disabled:opacity-50 disabled:cursor-not-allowed">
            Compare Selected (<span id="selectedCount">0</span>/2) ✨
        </button>
    </div>

    <!-- AI Comparison Modal -->
    <div id="comparisonModal" class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center p-4">
        <div class="bg-white rounded-xl shadow-xl max-w-2xl w-full p-6 relative m-4 max-h-[90vh] overflow-y-auto">
            <button id="comparisonModalClose" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl font-bold">✕</button>
            <h2 class="text-3xl font-bold mb-4 text-gray-900">AI Model Comparison ✨</h2>
            <div id="comparisonContent" class="prose max-w-none text-gray-800">
                <div class="flex justify-center items-center py-10">
                    <div class="spinner"></div>
                    <p class="ml-3 text-lg text-gray-600">Generating comparison...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Consolidated AI Models Data
            const aiModelsData = [
                {
                    id: "gpt-4o",
                    name: "GPT-4o",
                    provider: "OpenAI",
                    use_cases: ["Chatbot", "Creative Writing", "Code Generation", "Multimodal", "Vision", "Audio"],
                    context_length: 128000,
                    cost: { input: 5.00, output: 15.00 },
                    notes: "Flagship multimodal model with vision and audio capabilities. Highly capable across a wide range of tasks.",
                    benchmarks: { MMLU: "87.2%", HumanEval: "92.5%" },
                    links: { docs: "https://platform.openai.com/docs/models/gpt-4o", paper: "https://openai.com/index/hello-gpt-4o/", api: "https://platform.openai.com/docs/api-reference/chat" },
                    api_endpoint: "/v1/chat/completions"
                },
                {
                    id: "claude-3-opus",
                    name: "Claude 3 Opus",
                    provider: "Anthropic",
                    use_cases: ["Research & Analysis", "Creative Writing", "Chatbot", "Complex Reasoning"],
                    context_length: 200000,
                    cost: { input: 15.00, output: 75.00 },
                    notes: "Anthropic's most intelligent model, excelling in complex tasks and demonstrating fluency near human levels.",
                    benchmarks: { MMLU: "86.8%", HumanEval: "84.9%" },
                    links: { docs: "https://docs.anthropic.com/claude/docs/models-overview", paper: "https://www.anthropic.com/news/claude-3-family", api: "https://docs.anthropic.com/claude/reference/messages_post" },
                    api_endpoint: "/v1/messages"
                },
                {
                    id: "gemini-1.5-pro",
                    name: "Gemini 1.5 Pro",
                    provider: "Google",
                    use_cases: ["Research & Analysis", "Code Generation", "Multimodal", "Video Analysis", "Long-Context"],
                    context_length: 1000000,
                    cost: { input: 3.50, output: 10.50 },
                    notes: "Features a massive 1M token context window, making it ideal for long-document analysis and multimodal understanding.",
                    benchmarks: { MMLU: "88.0%", HumanEval: "90.2%" },
                    links: { docs: "https://developers.google.com/ai/models", paper: "https://deepmind.google/technologies/gemini/flash-and-pro/", api: "https://developers.google.com/ai/api" },
                    api_endpoint: "/v1/gemini"
                },
                {
                    id: "mistral-7b",
                    name: "Mistral 7B",
                    provider: "Mistral.ai",
                    use_cases: ["Lightweight Apps", "Open-Source AI", "Experimentation"],
                    context_length: 32000,
                    cost: { input: 0.00, output: 0.00 }, // Assuming free for open-weight models
                    notes: "Free, open-weight small model ideal for local deployments and experimentation. Strong performance for its size.",
                    benchmarks: { MMLU: "75.3%", HumanEval: "60.1%" },
                    links: { docs: "https://huggingface.co/mistralai/Mistral-7B-Instruct-v0.2", paper: "https://arxiv.org/abs/2310.06825", api: "https://docs.mistral.ai/" },
                    api_endpoint: "N/A"
                },
                {
                    id: "perplexity-ai",
                    name: "Perplexity AI",
                    provider: "Perplexity",
                    use_cases: ["Web Search", "Summarization", "Real-time Information"],
                    context_length: null, // Context length not directly applicable for search engine
                    cost: { input: 0.00, output: 0.00 }, // Free to use basic service
                    notes: "AI-powered search engine with quick summarization capabilities and real-time information retrieval.",
                    benchmarks: {}, // Benchmarks not typically applicable for search engines
                    links: { docs: "https://www.perplexity.ai/about", paper: null, api: "https://docs.perplexity.ai/docs" },
                    api_endpoint: "N/A"
                },
                {
                    id: "gpt-3.5-turbo",
                    name: "GPT-3.5 Turbo",
                    provider: "OpenAI",
                    use_cases: ["General Text Generation", "Chatbots", "Summarization", "Content Creation"],
                    context_length: 16385,
                    cost: { input: 0.50, output: 1.50 },
                    notes: "Cost-effective model, good for many everyday tasks. Offers a balance of capability and speed.",
                    benchmarks: { MMLU: "70.0%", HumanEval: "48.1%" },
                    links: { docs: "https://platform.openai.com/docs/models/gpt-3-5", paper: "https://openai.com/blog/chatgpt", api: "https://platform.openai.com/docs/api-reference/chat" },
                    api_endpoint: "/v1/chat/completions"
                },
                {
                    id: "gpt-4-turbo",
                    name: "GPT-4 Turbo",
                    provider: "OpenAI",
                    use_cases: ["Code Generation", "Complex Reasoning", "Chat", "Vision", "Advanced Analysis"],
                    context_length: 128000,
                    cost: { input: 10.00, output: 30.00 },
                    notes: "Large multimodal model with a 128K context window, excelling at complex reasoning, code generation, and following nuanced instructions.",
                    benchmarks: { MMLU: "87.0%", HumanEval: "90.0%" },
                    links: { docs: "https://platform.openai.com/docs/models/gpt-4-turbo-and-gpt-4", paper: "https://cdn.openai.com/papers/gpt-4.pdf", api: "https://platform.openai.com/docs/api-reference/chat" },
                    api_endpoint: "/v1/chat/completions"
                },
                {
                    id: "llama-3-70b",
                    name: "Llama 3 70B",
                    provider: "Meta",
                    use_cases: ["Chat", "Open Source", "Code Generation", "Research", "Fine-tuning"],
                    context_length: 8000,
                    cost: { input: 0.00, output: 0.00 },
                    notes: "A powerful, open-weights large language model designed for a wide range of applications, with strong performance in reasoning and instruction following.",
                    benchmarks: { MMLU: "75.3%", HumanEval: "60.1%" },
                    links: { docs: "https://llama.meta.com/llama3/", paper: "https://arxiv.org/abs/2404.07143", api: null },
                    api_endpoint: "N/A"
                },
                {
                    id: "claude-3-sonnet",
                    name: "Claude 3 Sonnet",
                    provider: "Anthropic",
                    use_cases: ["Enterprise", "Chat", "Data Processing", "Automation"],
                    context_length: 200000,
                    cost: { input: 3.00, output: 15.00 },
                    notes: "An ideal balance of intelligence and speed, designed for enterprise workloads and scaled AI deployments. Strong at knowledge retrieval and automation.",
                    benchmarks: { MMLU: "79.0%", HumanEval: "70.0%" },
                    links: { docs: "https://docs.anthropic.com/claude/docs/models-overview", paper: "https://www.anthropic.com/news/claude-3-family", api: "https://docs.anthropic.com/claude/reference/messages_post" },
                    api_endpoint: "/v1/messages"
                },
                {
                    id: "dall-e-3",
                    name: "DALL-E 3",
                    provider: "OpenAI",
                    use_cases: ["Image Generation", "Art Creation", "Visual Content"],
                    context_length: null,
                    cost: { input: 0.00, output: 0.00 },
                    notes: "An AI system that can create realistic images and art from a description in natural language. Integrated with ChatGPT for prompt enhancement.",
                    benchmarks: {},
                    links: { docs: "https://platform.openai.com/docs/guides/images/dall-e-3", paper: "https://openai.com/dall-e-3", api: "https://platform.openai.com/docs/api-reference/images" },
                    api_endpoint: "/v1/images/generations"
                }
            ];

            // DOM Elements
            const modelsGrid = document.getElementById('models-grid');
            const searchInput = document.getElementById('search');
            const providerFilter = document.getElementById('provider-filter');
            const useCaseFiltersContainer = document.getElementById('use-case-filters');
            const resetBtn = document.getElementById('reset-filters');
            const noResultsMessage = document.getElementById('no-results');

            // Model Detail Modal elements
            const modelDetailModal = document.getElementById('modelModal');
            const modelDetailCloseBtn = document.getElementById('modalClose');
            const titleEl = document.getElementById('modalTitle');
            const providerEl = document.getElementById('modalProvider');
            const benchEl = document.getElementById('modalBenchmarks');
            const linksEl = document.getElementById('modalLinks');
            const endpointEl = document.getElementById('modalEndpoint');

            // Comparison Feature elements
            const compareButtonContainer = document.getElementById('compareButtonContainer');
            const compareModelsBtn = document.getElementById('compareModelsBtn');
            const selectedCountSpan = document.getElementById('selectedCount');
            const comparisonModal = document.getElementById('comparisonModal');
            const comparisonModalCloseBtn = document.getElementById('comparisonModalClose');
            const comparisonContent = document.getElementById('comparisonContent');

            let contextChart; // Chart.js instance
            let selectedModelsForComparison = []; // Array to store IDs of models selected for comparison

            // --- 1. Filter Setup ---
            function setupFilters() {
                // Populate Provider Filter
                const providers = [...new Set(aiModelsData.map(m => m.provider))].sort();
                providers.forEach(p => {
                    let opt = document.createElement('option');
                    opt.value = p;
                    opt.textContent = p;
                    providerFilter.appendChild(opt);
                });

                // Populate Use Case Checkboxes
                const useCases = [...new Set(aiModelsData.flatMap(m => m.use_cases))].sort();
                useCases.forEach(uc => {
                    let div = document.createElement('div');
                    div.className = 'flex items-center';
                    let cb = document.createElement('input');
                    cb.type = 'checkbox';
                    cb.id = `uc-${uc.replace(/\s/g, '-')}`; // Sanitize ID for spaces
                    cb.value = uc;
                    cb.className = 'h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500';
                    let lbl = document.createElement('label');
                    lbl.htmlFor = `uc-${uc.replace(/\s/g, '-')}`;
                    lbl.textContent = uc;
                    lbl.className = 'ml-2 block text-sm text-gray-900';
                    div.appendChild(cb);
                    div.appendChild(lbl);
                    useCaseFiltersContainer.appendChild(div);
                });
            }

            // --- 2. Render Model Cards ---
            function renderModels(models) {
                modelsGrid.innerHTML = ''; // Clear existing models
                if (models.length === 0) {
                    noResultsMessage.classList.remove('hidden');
                } else {
                    noResultsMessage.classList.add('hidden');
                }

                models.forEach(model => {
                    const card = document.createElement('div');
                    // Add 'selected-for-comparison' class if the model is currently selected
                    const isSelected = selectedModelsForComparison.includes(model.id);
                    card.className = `bg-white rounded-xl border border-gray-200 shadow-sm p-6 flex flex-col transition hover:shadow-lg hover:-translate-y-1 cursor-pointer ${isSelected ? 'border-blue-500 ring-2 ring-blue-500' : ''}`;
                    card.dataset.modelId = model.id; // Store model ID on the card element

                    // Generate HTML for use case tags
                    const useHtml = model.use_cases.map(uc =>
                        `<span class="inline-block bg-blue-100 text-blue-800 text-xs font-medium mr-2 mb-2 px-2.5 py-0.5 rounded-full">${uc}</span>`
                    ).join('');

                    card.innerHTML = `
                        <div class="flex-grow">
                            <div class="flex justify-between items-start">
                                <h3 class="text-lg font-bold text-gray-900">${model.name}</h3>
                                <span class="text-sm font-semibold text-gray-500">${model.provider}</span>
                            </div>
                            <p class="text-sm text-gray-600 mt-2 mb-4">${model.notes || 'No description available.'}</p>
                            <div class="flex flex-wrap">${useHtml}</div>
                        </div>
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-500">Context Window:</span>
                                <span class="font-semibold text-gray-800">${model.context_length?.toLocaleString() || 'N/A'} tokens</span>
                            </div>
                            <div class="flex justify-between text-sm mt-1">
                                <span class="text-gray-500">Cost (per 1M tokens):</span>
                                <span class="font-semibold text-gray-800">
                                    ${model.cost && model.cost.input !== undefined && model.cost.output !== undefined
                                        ? `$${model.cost.input.toFixed(2)} (in) / $${model.cost.output.toFixed(2)} (out)`
                                        : 'N/A'
                                    }
                                </span>
                            </div>
                        </div>
                        <button class="compare-toggle-btn mt-4 w-full text-center px-4 py-2 rounded-lg transition
                            ${isSelected ? 'bg-red-500 hover:bg-red-600 text-white' : 'bg-blue-500 hover:bg-blue-600 text-white'}">
                            ${isSelected ? 'Remove from Compare' : 'Add to Compare'}
                        </button>
                    `;
                    // Attach click listener to open the model detail modal
                    card.querySelector('.flex-grow').addEventListener('click', (e) => {
                        // Prevent opening detail modal when clicking the compare button
                        if (!e.target.closest('.compare-toggle-btn')) {
                            openModelDetail(model.id);
                        }
                    });

                    // Attach click listener for the compare toggle button
                    card.querySelector('.compare-toggle-btn').addEventListener('click', (e) => {
                        e.stopPropagation(); // Prevent card click event from firing
                        toggleModelForComparison(model.id);
                    });

                    modelsGrid.appendChild(card);
                });
                updateCompareButtonState(); // Update the floating compare button state after rendering
            }

            // --- 3. Filter and Search Logic ---
            function filterAndRender() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedProvider = providerFilter.value;
                const selectedUseCases = Array.from(useCaseFiltersContainer.querySelectorAll('input:checked'))
                                            .map(cb => cb.value);

                let filteredModels = aiModelsData.filter(model => {
                    const matchesSearch = searchTerm === '' ||
                        model.name.toLowerCase().includes(searchTerm) ||
                        model.provider.toLowerCase().includes(searchTerm) ||
                        (model.notes && model.notes.toLowerCase().includes(searchTerm)) || // Check for notes existence
                        model.use_cases.some(uc => uc.toLowerCase().includes(searchTerm));

                    const matchesProvider = selectedProvider === '' || model.provider === selectedProvider;

                    const matchesUseCases = selectedUseCases.length === 0 ||
                                            selectedUseCases.every(selectedUc => model.use_cases.includes(selectedUc));

                    return matchesSearch && matchesProvider && matchesUseCases;
                });

                renderModels(filteredModels);
                updateChart(filteredModels); // Update chart based on filtered models
            }

            // --- 4. Chart.js Setup and Update ---
            function setupChart() {
                const ctx = document.getElementById('contextChart').getContext('2d');
                contextChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Context Length (Tokens)',
                            data: [],
                            backgroundColor: 'rgba(59, 130, 246, 0.6)', // Tailwind blue-500 with opacity
                            borderColor: 'rgba(59, 130, 246, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        indexAxis: 'y', // Horizontal bars
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false // Hide legend as only one dataset
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return `${context.dataset.label || ''}: ${context.parsed.x.toLocaleString()} tokens`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Context Length (Tokens)',
                                    color: '#4B5563' // gray-700
                                },
                                ticks: {
                                    callback: function(value) {
                                        if (value >= 1000000) return (value / 1000000) + 'M';
                                        if (value >= 1000) return (value / 1000) + 'K';
                                        return value;
                                    },
                                    color: '#4B5563'
                                },
                                grid: {
                                    color: '#E5E7EB' // gray-200
                                }
                            },
                            y: {
                                title: {
                                    display: false
                                },
                                ticks: {
                                    color: '#4B5563'
                                },
                                grid: {
                                    display: false
                                }
                            }
                        }
                    }
                });
            }

            function updateChart(data) {
                // Filter out models with null context_length before sorting for chart
                const chartData = data.filter(m => m.context_length !== null && typeof m.context_length === 'number');
                const sorted = [...chartData].sort((a, b) => a.context_length - b.context_length);

                contextChart.data.labels = sorted.map(m => m.name);
                contextChart.data.datasets[0].data = sorted.map(m => m.context_length);
                contextChart.update();
            }

            // --- 5. Model Detail Modal Logic ---
            function openModelDetail(id) {
                const model = aiModelsData.find(x => x.id === id);
                if (!model) {
                    console.error(`Model with ID "${id}" not found.`);
                    return;
                }

                titleEl.textContent = model.name;
                providerEl.textContent = `Provider: ${model.provider}`;

                // Benchmarks
                if (model.benchmarks && Object.keys(model.benchmarks).length > 0) {
                    benchEl.innerHTML = Object.entries(model.benchmarks)
                        .map(([k, v]) => `<p><strong>${k}:</strong> ${v}</p>`)
                        .join('');
                } else {
                    benchEl.innerHTML = '<p class="text-gray-500">No benchmark data available.</p>';
                }

                // Links
                if (model.links && Object.keys(model.links).length > 0) {
                    linksEl.innerHTML = `
                        ${model.links.docs ? `<p><strong>Docs:</strong> <a href="${model.links.docs}" target="_blank" class="text-blue-600 hover:underline">${model.links.docs}</a></p>` : ''}
                        ${model.links.paper ? `<p><strong>Paper/Announcement:</strong> <a href="${model.links.paper}" target="_blank" class="text-blue-600 hover:underline">${model.links.paper}</a></p>` : ''}
                        ${model.links.api ? `<p><strong>API Reference:</strong> <a href="${model.links.api}" target="_blank" class="text-blue-600 hover:underline">${model.links.api}</a></p>` : ''}
                    `;
                } else {
                    linksEl.innerHTML = '<p class="text-gray-500">No links available.</p>';
                }

                endpointEl.textContent = model.api_endpoint || 'N/A';

                modelDetailModal.classList.remove('hidden');
                modelDetailModal.classList.add('flex'); // Use flex to center with Tailwind
            }

            // --- 6. Comparison Feature Logic ---
            function toggleModelForComparison(modelId) {
                const index = selectedModelsForComparison.indexOf(modelId);
                if (index > -1) {
                    // Model is already selected, remove it
                    selectedModelsForComparison.splice(index, 1);
                } else {
                    // Model is not selected, add it if less than 2 are selected
                    if (selectedModelsForComparison.length < 2) {
                        selectedModelsForComparison.push(modelId);
                    } else {
                        // Optionally, alert the user or replace the oldest selection
                        // For simplicity, we'll just not add it if 2 are already selected
                        // You could add a small message box here instead of console.log
                        console.log("You can only compare up to 2 models at a time.");
                        return; // Do not proceed if already 2 selected
                    }
                }
                // Re-render models to update card styles and button text
                filterAndRender(); // This will call renderModels internally
                updateCompareButtonState();
            }

            function updateCompareButtonState() {
                selectedCountSpan.textContent = selectedModelsForComparison.length;
                if (selectedModelsForComparison.length > 0) {
                    compareButtonContainer.classList.remove('hidden');
                } else {
                    compareButtonContainer.classList.add('hidden');
                }

                if (selectedModelsForComparison.length === 2) {
                    compareModelsBtn.disabled = false;
                    compareModelsBtn.classList.remove('bg-gray-400', 'hover:bg-gray-500');
                    compareModelsBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                } else {
                    compareModelsBtn.disabled = true;
                    compareModelsBtn.classList.add('bg-gray-400', 'hover:bg-gray-500');
                    compareModelsBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                }
            }

            async function generateComparison() {
                if (selectedModelsForComparison.length !== 2) {
                    console.error("Please select exactly two models for comparison.");
                    return;
                }

                const model1 = aiModelsData.find(m => m.id === selectedModelsForComparison[0]);
                const model2 = aiModelsData.find(m => m.id === selectedModelsForComparison[1]);

                if (!model1 || !model2) {
                    console.error("Selected models not found in data.");
                    return;
                }

                // Show comparison modal and loading spinner
                comparisonModal.classList.remove('hidden');
                comparisonModal.classList.add('flex');
                comparisonContent.innerHTML = `
                    <div class="flex flex-col items-center justify-center py-10">
                        <div class="spinner mb-4"></div>
                        <p class="text-lg text-gray-600">Generating comparison for ${model1.name} and ${model2.name}...</p>
                        <p class="text-sm text-gray-500 mt-2">This may take a few moments.</p>
                    </div>
                `;

                const prompt = `
                    Compare and contrast the following two AI models in detail. Focus on their strengths, weaknesses, ideal use cases, and key differences based on the provided data. Structure your response with clear headings for each model and a dedicated section for comparison.

                    Model 1:
                    Name: ${model1.name}
                    Provider: ${model1.provider}
                    Use Cases: ${model1.use_cases.join(', ')}
                    Context Length: ${model1.context_length?.toLocaleString() || 'N/A'} tokens
                    Cost (per 1M tokens): Input $${model1.cost.input.toFixed(2)}, Output $${model1.cost.output.toFixed(2)}
                    Notes: ${model1.notes}
                    Benchmarks: ${Object.entries(model1.benchmarks).map(([k, v]) => `${k}: ${v}`).join(', ') || 'N/A'}

                    Model 2:
                    Name: ${model2.name}
                    Provider: ${model2.provider}
                    Use Cases: ${model2.use_cases.join(', ')}
                    Context Length: ${model2.context_length?.toLocaleString() || 'N/A'} tokens
                    Cost (per 1M tokens): Input $${model2.cost.input.toFixed(2)}, Output $${model2.cost.output.toFixed(2)}
                    Notes: ${model2.notes}
                    Benchmarks: ${Object.entries(model2.benchmarks).map(([k, v]) => `${k}: ${v}`).join(', ') || 'N/A'}

                    Provide a comprehensive comparison.
                `;

                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will provide this in runtime
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        comparisonContent.innerHTML = `<p class="whitespace-pre-wrap">${text}</p>`; // Display markdown
                    } else {
                        comparisonContent.innerHTML = '<p class="text-red-600">Failed to generate comparison. Please try again.</p>';
                        console.error("Gemini API response structure unexpected:", result);
                    }
                } catch (error) {
                    comparisonContent.innerHTML = '<p class="text-red-600">Error connecting to the AI. Please check your network and try again.</p>';
                    console.error("Error calling Gemini API:", error);
                } finally {
                    // Clear selected models after comparison
                    selectedModelsForComparison = [];
                    filterAndRender(); // Re-render to clear highlights and reset compare button
                }
            }

            // --- 7. Event Listeners ---
            // Model Detail Modal Close
            modelDetailCloseBtn.addEventListener('click', () => {
                modelDetailModal.classList.add('hidden');
                modelDetailModal.classList.remove('flex');
            });
            modelDetailModal.addEventListener('click', e => {
                if (e.target === modelDetailModal) {
                    modelDetailModal.classList.add('hidden');
                    modelDetailModal.classList.remove('flex');
                }
            });

            // Comparison Modal Close
            comparisonModalCloseBtn.addEventListener('click', () => {
                comparisonModal.classList.add('hidden');
                comparisonModal.classList.remove('flex');
            });
            comparisonModal.addEventListener('click', e => {
                if (e.target === comparisonModal) {
                    comparisonModal.classList.add('hidden');
                    comparisonModal.classList.remove('flex');
                }
            });

            // Filter and Search Listeners
            searchInput.addEventListener('input', filterAndRender);
            providerFilter.addEventListener('change', filterAndRender);
            useCaseFiltersContainer.addEventListener('change', filterAndRender);

            resetBtn.addEventListener('click', () => {
                searchInput.value = '';
                providerFilter.value = '';
                useCaseFiltersContainer.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
                selectedModelsForComparison = []; // Also reset comparison selection
                filterAndRender();
            });

            // Compare Models Button Listener
            compareModelsBtn.addEventListener('click', generateComparison);

            // --- Initial Load ---
            setupFilters();
            setupChart();
            filterAndRender(); // Initial render and chart update
            updateCompareButtonState(); // Initialize compare button state
        });
    </script>
</body>
</html>
